<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Experiment Log</title>

  <!-- Pico.css only -->
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css" />

  <style>
    /* Minimal, only small tweaks on top of pico.css.
       Removed the browser's blue focus/margin Ring for the tab buttons
       while preserving keyboard focus using :focus-visible if you want to restore later. */
    :root {
      --card-max-width: 900px;
      --table-visible-rows: 10;
    }

    main.container {
      max-width: 1050px;
      padding-top: 2rem;
    }

    /* Tabs: keep very small customizations, rely on pico for visuals */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--muted-border-color);
      margin-bottom: 1rem;
      overflow-x: auto;
      padding-left: 0;
    }

    .tabs button {
      appearance: none;
      -webkit-appearance: none;
      border: none;
      background: none;
      padding: .75rem 1.25rem;
      cursor: pointer;
      font-weight: 600;
      margin: 0;
      color: var(--muted-color);
      border-bottom: 3px solid transparent;
      transition: color .25s, border-color .25s;
      flex-shrink: 0;
      /* Remove the default blue focus ring */
      outline: none;
      box-shadow: none;
    }

    /* If you want an accessible focus indicator, uncomment the rule below:
    .tabs button:focus-visible {
      outline: 3px solid rgba(0,123,255,0.25);
      outline-offset: 2px;
    }
    */

    .tabs button.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      display: none;
      padding-top: 1rem;
    }

    .tab-content.active {
      display: block;
    }

    /* Cards: minimal styling */
    article.question-card {
      max-width: var(--card-max-width);
      margin-inline: auto;
      padding: 1.25rem;
      border-radius: 12px;
      border: 1px solid var(--muted-border-color);
      background: var(--card-background-color, var(--surface));
    }

    .question {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: .5rem;
      color: var(--contrast);
    }

    /* Table scroll */
    .table-scroll {
      max-height: calc(1.75rem * var(--table-visible-rows));
      overflow-y: auto;
      margin-top: 1rem;
    }

    pre { margin: 0; white-space: pre-wrap; word-break: break-word; }

    /* Tiny spinner */
    .spinner {
      width: 1rem; height: 1rem;
      border: 2px solid var(--muted-border-color);
      border-top-color: var(--primary);
      border-radius: 50%;
      display: inline-block;
      animation: spin 1s linear infinite;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg);} }

    .hidden { display: none !important; }
  </style>
</head>

<body>
<main class="container">
  <header>
    <h1>AI Experiment Log</h1>
    <p class="subtle">Multiple questions, auto-logged from Google Sheets.</p>
  </header>

  <div class="tabs" id="tab-buttons"></div>
  <section id="tab-contents"></section>
</main>

<script>
  const QUESTIONS = [
    {
      text: "What is the largest number: 27483 or 27482?",
      sheetURL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTXKtJnPba45mGoBCOkphmfIe1bS6gq3VIywNJtCcDhQYiGOHvc94LhFqkvyO1Q-pelZIzrIxv9X5KC/pub?gid=0&single=true&output=csv"
    },
    {
      text: "Write a Python function to return the square of a number.",
      sheetURL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTXKtJnPba45mGoBCOkphmfIe1bS6gq3VIywNJtCcDhQYiGOHvc94LhFqkvyO1Q-pelZIzrIxv9X5KC/pub?gid=269864323&single=true&output=csv"
    }
  ];

  const escapeHTML = s => s.replace(/[&<>]/g, c => ({ "&":"&amp;","<":"&lt;",">":"&gt;" }[c]));

  function parseCSV(text) {
    const lines = text.trim().split(/\r?\n/).slice(1);
    const rows = []; let buffer = "";
    for (let line of lines) {
      if (buffer) line = buffer + "\n" + line;
      const quotes = (line.match(/"/g) || []).length;
      if (quotes % 2 === 0) { rows.push(line); buffer = ""; }
      else buffer = line;
    }
    return rows;
  }

  function splitAnswerDate(line) {
    const i = line.lastIndexOf(",");
    return [line.slice(0, i), line.slice(i + 1)];
  }

  async function loadAnswers(card, url) {
    const status = card.querySelector(".status");
    const container = card.querySelector(".table-scroll");
    const tbody = container.querySelector("tbody");

    try {
      const csv = await fetch(url + "&_=" + Date.now()).then(r => r.text());
      const lines = parseCSV(csv);
      if (!lines.length) return status.textContent = "No rows yet.";

      lines.forEach((line, i) => {
        let [ans, date] = splitAnswerDate(line);
        ans = ans.replace(/^"|"$/g, "");
        tbody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td><pre>${escapeHTML(ans)}</pre></td>
            <td>${escapeHTML(date)}</td>
          </tr>`;
      });

      status.classList.add("hidden");
      container.classList.remove("hidden");
    } catch {
      status.textContent = "Error loading data.";
    }
  }

  (function init() {
    const tabButtons = document.getElementById("tab-buttons");
    const tabContents = document.getElementById("tab-contents");

    QUESTIONS.forEach((q, index) => {
      const btn = document.createElement("button");
      btn.textContent = `Question ${index + 1}`;
      btn.onclick = () => switchTab(index);
      tabButtons.appendChild(btn);

      const content = document.createElement("section");
      content.className = "tab-content";
      content.innerHTML = `
        <article class="question-card">
          <div class="question">${escapeHTML(q.text)}</div>
          <div class="status"><span class="spinner"></span> Loading answersâ€¦</div>
          <div class="table-scroll hidden">
            <table>
              <thead><tr><th>#</th><th>Answer</th><th>Date</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>`;
      tabContents.appendChild(content);

      loadAnswers(content, q.sheetURL);
    });

    function switchTab(i) {
      document.querySelectorAll(".tabs button").forEach((b, j) =>
        b.classList.toggle("active", j === i)
      );
      document.querySelectorAll(".tab-content").forEach((c, j) =>
        c.classList.toggle("active", j === i)
      );
    }

    switchTab(0);
  })();
</script>

</body>
</html>
